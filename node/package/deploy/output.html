<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,
        target-densityDpi=device-dpi">

	<title>Chatbot</title>
	
<!-- ./css/umum.css mulai: -->
 <style>
 html,
body {
	height: 100%;
}

* {
	margin: 0px;
	padding: 0px;
	box-sizing: border-box;
}

button {
	padding: 8px;
}

.back {
	width: 100%;
	height: 100%;
	top: 0px;
	left: 0px;
	right: 0px;
	bottom: 0px;
	position: absolute;
	background-color: rgba(0, 0, 0, .1);
	padding: 16px;
}

.back-putih,
.back-white,
.back-color-white {
	background-color: white;
}

/* dialog */
div.dialog {
	position: fixed;
	box-sizing: border-box;
	top: 0px;
	left: 0px;
	bottom: 0px;
	right: 0px;
	;
	background-color: rgba(0, 0, 0, .1);
	z-index: 1000;
	display: none;
}

div.dialog div.box {
	display: flex;
	flex-direction: column;
	padding: 16px;
	width: 100%;
	min-height: 200px;
	background-color: white;
	text-align: center;
}

div.dialog div.box p {
	flex-grow: 1;
}

/* loading */
div.loading {
	display: flex;
	position: fixed;
	top: 0px;
	left: 0px;
	right: 0px;
	bottom: 0px;
	background-color: rgba(0, 0, 0, .1);
	z-index: 100;
	font-weight: bolder;
	text-align: center;
	text-shadow: 1px 1px 1px rgba(255, 255, 255, 1);
	user-select: none;
	/* select */
}

div.loading div.box {
	width: 80%;
	margin: auto;
	text-align: center;
}

div.clear {
	float: none;
	clear: both;
}


/* FRAMEWORK */
html {
	font-family: Arial, Helvetica, sans-serif;
}

.pos-rel,
.relative {
	position: relative;
}

.pos-abs {
	position: absolute;
}

.pos-fixed {
	position: fixed;
}

a.tambah {
	position: fixed;
	bottom: 32px;
	right: 32px;
	padding: 16px;
	background-color: cornflowerblue;
	border-radius: 50%;
	color: white;
	padding-right: 24px;
	padding-left: 24px;
	text-align: center;
}

/* font */
button.btn-wa {
	background-color: #25D366;
}

a.bersih {
	text-decoration: none;
	color: initial;
}

.fontello {
	font-family: 'fontello';
}

.bold {
	font-weight: bold;
}


/* layout */
.disp-inline-block {
	display: inline-block;
}

.disp-block {
	display: block;
}

.border {
	border: 1px solid grey;
}

.padding,
.padding-8 {
	padding: 8px;
}

.padding-4 {
	padding: 4px;
}

.margin {
	margin: 8px;
}

.margin-auto {
	margin: auto;
}

.margin-bottom-8 {
	margin-bottom: 8px;
}

.white-space-pre {
	white-space: pre;
}

.text-align-center {
	text-align: center;
}

.text-align-right {
	text-align: right;
}

.text-align-left {
	text-align: left;
}

.potong,
.potong-2 {
	display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
	overflow: hidden;
}

.text-overflow-elipsis {
	text-overflow: ellipsis;
}

.inline-block,
.disp-inline-block {
	display: inline-block;
}


.float {
	float: left;
}

.clear {
	clear: both;
}

/*FLEX*/
.display-flex,
.disp-flex {
	display: flex
}

.flex-dir-row {
	flex-direction: row;
}

.flex-dir-col {
	flex-direction: column;
}

.flex-grow-1,
.flex-grow-12 {
	flex-grow: 1
}

.align-items-center {
	align-items: center
}

.tengah-tengah {
	display: flex;
	justify-content: center;
	align-items: center;
}

.left-0 {
	left: 0px;
}

.top-0 {
	top: 0px
}


.height-12 {
	height: 100%;
}

.min-height-12 {
	min-height: 100%;
}

.min-height-6 {
	min-height: 50%;
}

.wbreak-keep-all {
	word-break: keep-all;
}

.white-space-nowrap,
.wspace-nowrap {
	white-space: nowrap;
}

.width-3 {
	width: 25%;
}

.width-6 {
	width: 50%;
}

.width-12 {
	width: 100%;
} 
</style> 
<!-- ./css/umum.css selesai -->

	
<!-- ./css/css.css mulai: -->
 <style>
 html,
body {
    margin: 0px;
    padding: 0px;
    width: 100%;
}

body {
    padding: 16px;
}

div.cont {
    max-width: 100vh;
    /* border: 1px solid; */
}

div.chat-cont {
    overflow-y: auto;
    border: 1px solid;
}

div.balas {
    border: 1px solid;
}

div.chat-bot {
    background-color: antiquewhite;
    border: 1px solid rgba(0, 0, 0, .5);
    width: 75%;
    max-width: 75%;
    border-radius: 10px;
}

div.jawab div.chat-bot {
    background-color: aqua;
} 
</style> 
<!-- ./css/css.css selesai -->

</head>

<body>
	<div class="cont padding disp-flex flex-dir-col height-12 margin-auto">

		<div class="chat-cont padding flex-grow-1">

		</div>

		<div class="padding"></div>

		<div class="balas padding">
			<form class="balas disp-flex">
				<input type="text" class="chat jawab flex-grow-1 padding" />
				<div class="padding">
					<button class="kirim" type="submit">ðŸ’¬</button>
				</div>
			</form>
		</div>

	</div>

	
<!-- ./js/comp/Util.js mulai: -->
 <script>
 var ha;
(function (ha) {
    var comp;
    (function (comp) {
        class Util {
            static sUserId = 'user_id';
            static sLevel = 'level';
            static sFilter = 'filter';
            static storageId = 'xyz.hagarden.tugas';
            static createEl(str) {
                let div = document.createElement('div');
                let el;
                div.innerHTML = str;
                el = div.firstElementChild;
                if (!el) {
                    console.log(div);
                    console.log(str);
                    throw new Error('');
                }
                return el;
            }
            static getTemplate(query) {
                try {
                    let template = document.body.querySelector('template').content;
                    return template.querySelector(query).cloneNode(true);
                }
                catch (e) {
                    console.log('template:' + query);
                    throw Error(e);
                }
            }
            static getEl(query, parent = null, err = true) {
                let el;
                if (!parent)
                    parent = document.body;
                el = parent.querySelector(query);
                if (el) {
                    return el;
                }
                else {
                    console.log(parent);
                    console.log(query);
                    if (err) {
                        throw new Error('query not found ');
                    }
                    else {
                        return null;
                    }
                }
            }
            static id() {
                return Date.now();
            }
            static async delay(m = 10) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve();
                    }, m);
                });
            }
            static stackTrace() {
                try {
                    throw Error('');
                }
                catch (e) {
                    console.error(e);
                }
            }
            static bersihDiv(div) {
                while (div.firstChild) {
                    div.removeChild(div.firstChild);
                }
            }
            //default error
            static error(e) {
                console.error(e);
                comp.dialog.tampil(e.message);
            }
            //shared
            static kirimWa(teks) {
                return "whatsapp://send?text=" + teks;
            }
            static getUrl(url, params) {
                let urlHasil = url;
                console.group('get url');
                console.log('url: ' + url);
                console.log('params: ' + JSON.stringify(params));
                params.forEach((item) => {
                    console.log('reg: ' + urlHasil.search(/\:[a-zA-Z_0-9]+/));
                    urlHasil = urlHasil.replace(/\:[a-zA-Z_0-9]+/, item + '');
                    console.log('item: ' + item);
                    console.log('url: ' + urlHasil);
                });
                console.log('url hasil: ' + urlHasil);
                console.groupEnd();
                return urlHasil;
            }
            static build(temp) {
                let div = document.createElement('div');
                let el;
                div.innerHTML = temp;
                el = div.firstElementChild;
                // this._elHtml = el;
                if (!el) {
                    console.log(div);
                    console.log(temp);
                    throw new Error('');
                }
                return el;
            }
            static async AjaxLogin(type, urlServer, dataStr, loginUrl, pf = null) {
                let xml;
                xml = await this.Ajax(type, urlServer, dataStr, pf);
                if (401 == xml.status) {
                    window.top.location.href = loginUrl;
                    return null;
                }
                else {
                    return xml;
                }
            }
            static async Ajax2(type, url, dataStr, pf = null) {
                let x = await this.Ajax(type, url, dataStr, pf);
                if (x.status == 200 || x.status == 0) {
                    return x.responseText;
                }
                console.log('error status code: ' + x.status);
                throw Error(x.responseText);
            }
            static async Ajax(type, url, dataStr, pf = null) {
                return new Promise((resolve, reject) => {
                    try {
                        console.group('send data');
                        // console.log(dataStr);
                        console.log("type " + type);
                        comp.loading.attach(document.body);
                        let xhr = new XMLHttpRequest();
                        xhr.onload = () => {
                            comp.loading.detach();
                            resolve(xhr);
                        };
                        xhr.onerror = (e) => {
                            console.log('xhr error');
                            console.log(e);
                            comp.loading.detach();
                            reject(new Error(e.message));
                        };
                        xhr.onprogress = (p) => {
                            if (pf) {
                                pf(p);
                            }
                        };
                        xhr.open(type, url + "", true);
                        xhr.setRequestHeader('Content-type', 'application/json');
                        // xhr.setRequestHeader('from', window.sessionStorage.getItem(Util.sUserId));
                        // xhr.setRequestHeader('id', window.sessionStorage.getItem(Util.sUserId));
                        xhr.send(dataStr);
                        // console.log("type " + type);
                        // console.log("url " + url);
                        console.groupEnd();
                    }
                    catch (e) {
                        console.log('Util error');
                        console.log(e);
                        comp.loading.detach();
                        reject(new Error(e.message));
                    }
                });
            }
        }
        comp.Util = Util;
    })(comp = ha.comp || (ha.comp = {}));
})(ha || (ha = {}));
 
</script> 
<!-- ./js/comp/Util.js selesai -->


	
<!-- ./js/config.js mulai: -->
 <script>
 
 let fileCache = [{"path":"hal-edit-fungsi.html","file":"<div class=\"cont hal-edit-fungsi\">\r\n\r\n\t<div class=\"header\">\r\n\t\t<button onclick=\"HalEditFungsi.klikTombolKembali()\">â¬…</button> Fungsi <span class=\"nama\"></span>\r\n\t</div>\r\n\r\n\t<div class=\"padding-4\"></div>\r\n\r\n\t<!-- param -->\r\n\t<div class=\"param padding\">\r\n\r\n\t\t<div class=\"header\">\r\n\t\t\t<span>Param</span>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"daftar\">\r\n\r\n\t\t</div>\r\n\r\n\t\t<div class=\"menu padding\">\r\n\t\t\t<button class=\"tambah\" onclick=\"HalEditFungsi.klikTombolParamTambah()\">tambah</button>\r\n\t\t\t<button class=\"hapus\" onclick=\"HalEditFungsi.klikTombolParamHapus()\">hapus</button>\r\n\t\t\t<button class=\"edit\" onclick=\"HalEditFungsi.klikTombolParamEdit()\">edit</button>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<!-- variable -->\r\n\t<div class=\"variable padding\">\r\n\r\n\t\t<div class=\"header\">\r\n\t\t\t<span>variable</span>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"daftar\">\r\n\r\n\t\t</div>\r\n\r\n\t\t<div class=\"menu padding\">\r\n\t\t\t<button class=\"tambah\" onclick=\"HalEditFungsi.klikTombolTambahVariable()\">tambah</button>\r\n\t\t\t<button class=\"hapus\" onclick=\"HalEditFungsi.klikTombolHapusVariable()\">hapus</button>\r\n\t\t\t<button class=\"edit\" onclick=\"HalEditFungsi.klikTombolEditVariable()\">edit</button>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<!-- stmt  -->\r\n\t<div class=\"stmt padding\">\r\n\r\n\t\t<div class=\"header\">\r\n\t\t\t<span>Stmt</span>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"daftar\">\r\n\r\n\t\t</div>\r\n\r\n\t\t<div class=\"menu padding\">\r\n\t\t\t<button class=\"tambah\" onclick=\"HalEditFungsi.klikTombolSisip()\">sisip</button>\r\n\t\t\t<button class=\"tambah\" onclick=\"HalEditFungsi.klikTombolTambah()\">sub</button>\r\n\t\t\t<button class=\"hapus\" onclick=\"HalEditFungsi.klikTombolHapus()\">hapus</button>\r\n\t\t</div>\r\n\t</div>"}] 
 
</script> 
<!-- ./js/config.js selesai -->

	
<!-- ./js/data.js mulai: -->
 <script>
 /**
 * data untuk chatbot
 */
const data = [
    //menu utama
    {
        label: 'menu-utama',
        isi: `
            Assalamu'alaikum. <br/>
            Hari ini kita akan belajar bersama. <br/>
            Sebelum mulai, mari kenalan dulu yuk <br/>
            Siapa namamu?
        `,
        gotoDef: ['pilih']
    },
    //pilih pelajaran
    {
        label: 'pilih',
        isi: `
            Silahkan pilih pelajaran yang ingin dipelajari:
            <br/>
            <br/>
        `,
        menu: [
            {
                judul: 'matematika',
                goto: ['matematika', 'soal-1']
            },
            {
                judul: 'bahasa indonesia',
                goto: ['kosong', 'pilih']
            },
            {
                judul: 'bahasa arab',
                goto: ['kosong', 'pilih']
            },
        ],
    },
    //benar salah
    {
        label: 'benar',
        isi: `
            Hebat!<br/>
            jawaban kamu benar
        `
    },
    {
        label: 'salah',
        isi: `
            Jawaban kamu salah!<br/>
            Tidak mengapa, jangan menyerah<br/>
        `
    },
    //pelajaran kosong
    {
        label: 'kosong',
        isi: `
            Waaaah, maaf!!. ðŸ˜¥ <br/> 
            Pelajaran tersebut belum tersedia. <br/> 
            Pilih yang lain aja ya
        `
    },
    //pelajaran ada
    {
        label: 'matematika',
        isi: `
            Hari ini kita akan belajar berhitung. <br/>
            Coba selesaikan soal-soal berikut
        `,
        gotoDef: ['soal-1']
    },
    //soal 1
    {
        label: 'soal-1',
        isi: `
            Soal 1. <br/>
            Berapa jumlahnya?<br/>
            1 + 1
        `,
        resp: [
            {
                judul: '2',
                goto: ['benar', 'soal-2']
            }
        ],
        gotoDef: ['salah', 'soal-1']
    },
    //soal 2
    {
        label: 'soal-2',
        isi: `
            Soal 2. <br/>
            Berapa jumlahnya?<br/>
            1 + 2
        `,
        resp: [
            {
                judul: '3',
                goto: ['benar', 'soal-3']
            }
        ],
        gotoDef: ['salah', 'soal-2']
    },
    //soal - 3
    {
        label: 'soal-3',
        isi: `
            Soal 3: <br/>
            Berapa jumlahnya?<br/>
            2 + 1
        `,
        resp: [
            {
                judul: '3',
                goto: ['benar', 'selesai', 'pilih']
            }
        ],
        gotoDef: ['salah', 'soal-3']
    },
    //selesai
    {
        label: 'selesai',
        isi: `
            Selamat!<br/>
            Kamu sudah menyelesaikan semua soal.
        `
    },
];
 
</script> 
<!-- ./js/data.js selesai -->

	
<!-- ./js/Index.js mulai: -->
 <script>
 class Chat {
    static _chatAktif;
    static getByLabel(label) {
        let hasil;
        data.forEach((item) => {
            if (item.label == label) {
                hasil = item;
            }
        });
        return hasil;
    }
    static renderText(str, cont, jawab = false) {
        let div;
        let divCont;
        divCont = document.createElement('div');
        divCont.classList.add('padding');
        div = document.createElement('div');
        div.classList.add('chat-bot');
        div.classList.add('padding');
        div.classList.add('inline-block');
        div.innerHTML = str;
        divCont.appendChild(div);
        if (jawab) {
            divCont.classList.add('jawab');
            divCont.classList.add('text-align-right');
            // div.classList.add('text-align-left');
        }
        cont.appendChild(divCont);
        return divCont;
    }
    static renderMenu(menu) {
        let hasil;
        hasil = document.createElement('div');
        let tbl;
        tbl = document.createElement('button');
        tbl.classList.add('padding');
        tbl.classList.add('inline-block');
        tbl.style.marginBottom = '4px';
        tbl.innerHTML = menu.judul;
        tbl.onclick = async (e) => {
            e.stopPropagation();
            jawabTxt.value = menu.judul;
            chatCont.scrollTop = chatCont.scrollHeight;
            await ha.comp.Util.delay(500);
            await this.kirim(menu.judul);
            jawabTxt.value = '';
            chatCont.scrollTop = chatCont.scrollHeight;
        };
        hasil.appendChild(tbl);
        return hasil;
    }
    static render(data, jawab = false) {
        let div = this.renderText(data.isi, chatCont, jawab);
        let menuEl = div.querySelector('div.chat-bot');
        if (data.menu) {
            data.menu.forEach((item) => {
                //render menu
                menuEl.appendChild(this.renderMenu(item));
                //padding
            });
        }
    }
    static mirip(test, teks) {
        test = test.toLowerCase();
        teks = teks.toLowerCase();
        test = test.trim().toLowerCase();
        teks = teks.trim().toLowerCase();
        if (test == teks)
            return true;
        // if (test.includes(teks)) return true;
        // if (teks.includes(test)) return true;
        //75%
        return false;
    }
    static async getGoto(teks) {
        let hasil = [];
        console.group('get goto');
        console.debug('teks: ' + teks);
        //check default
        if (this._chatAktif.gotoDef) {
            console.log('ada di def');
            console.log(this._chatAktif);
            hasil = this._chatAktif.gotoDef;
        }
        //check ada di response
        if (this.chatAktif.menu) {
            this._chatAktif.menu.forEach((item) => {
                if (this.mirip(item.judul, teks)) {
                    hasil = item.goto;
                    console.log('ada di menu');
                    console.log(hasil);
                    console.log(item.goto);
                }
            });
        }
        //check ada di menu
        if (this._chatAktif.resp) {
            this._chatAktif.resp.forEach((item) => {
                if (this.mirip(item.judul, teks)) {
                    console.log('ada di resp');
                    hasil = item.goto;
                }
            });
        }
        console.debug('hasil:');
        console.debug(hasil);
        console.groupEnd();
        chatCont.scrollTop = chatCont.scrollHeight;
        await ha.comp.Util.delay(500);
        return hasil;
    }
    static async kirim(teks = '') {
        teks = teks.trim();
        if (teks.length == 0)
            return;
        this.renderText(teks, chatCont, true);
        let goto = await this.getGoto(teks);
        if (goto.length == 0) {
            let chat = this._chatAktif;
            // chat = this.getByLabel(item);
            this.render(chat);
            return;
        }
        goto.forEach((item) => {
            let chat;
            chat = this.getByLabel(item);
            this._chatAktif = chat;
            this.render(chat);
        });
    }
    static get chatAktif() {
        return Chat._chatAktif;
    }
    static set chatAktif(value) {
        Chat._chatAktif = value;
    }
}
const chatCont = ha.comp.Util.getEl('div.chat-cont');
const kirimTbl = ha.comp.Util.getEl('button.kirim');
const jawabTxt = ha.comp.Util.getEl('input.jawab');
const formBalas = ha.comp.Util.getEl('form.balas');
Chat.chatAktif = data[0];
Chat.render(data[0]);
// Chat.render(data[1]);
formBalas.onsubmit = async (e) => {
    e.stopPropagation();
    e.preventDefault();
    await Chat.kirim(jawabTxt.value);
    jawabTxt.value = '';
    chatCont.scrollTop = chatCont.scrollHeight;
};
 
</script> 
<!-- ./js/Index.js selesai -->

</body>

</html>